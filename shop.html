<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <script src="storage.js"></script>

        <script>
            let cart = {
                items: [],
            };

            // restore cart
            document.addEventListener('DOMContentLoaded', () => {
                  
                const savedCart = Storage.getCart();

                if (savedCart) {
                    cart = JSON.parse(savedCart);
                }

                renderCart(cart);


         
            });

            const renderCart = (cart) => {
                const itemsHtml = cart.items.map(item => renderItem(item)).join('');
                const totalHtml = renderTotal(cart);

                const cartHtml = 
                    `<div>
                        <div>Cart</div>
                        <div>Items:</div>
                        ${itemsHtml}
                        <div>Totals:</div>
                        ${totalHtml}
                    </div>`;
                    console.log(cartHtml)
                    document.querySelector('#cart').innerHTML = cartHtml;
            }

            const renderItem = (item) => {
                return `<div class="item">
                    <div class="actions"><button onclick="addItem(${item.id})">+</button><button onclick="removeItem(${item.id})">-</button></div> <div> ${item.name} ${item.quantity} x ${parseFloat(item.priceSell).toFixed(2)} </div>
                </div>`;
            }
          
            const addItem = (itemId) => {
                cart.items.find(item => item.id === itemId).quantity += 1;
                Storage.saveCart(cart);
                renderCart(cart);
            }

            const removeItem = (itemId) => {
                cart.items.find(item => item.id === itemId).quantity -= 1;
                Storage.saveCart(cart);
                renderCart(cart);
            }

            const clearCart = () => {
                cart = { 
                    items: []
                }
            }

            const clearCartAndReRender = (itemId) => {
                clearCart()
                Storage.saveCart(cart);
                renderCart(cart);
            }


            const calcTotal = (cart) => {
                return cart.items.reduce((total, item) => {
                    total += item.quantity * item.priceSell;
                    return total;
                }, 0)
            }

            const renderTotal = (cart) => {
                const total = calcTotal(cart);
 
                return `<div>${total.toFixed(2)}</div>`;
            }

            const addToCart = (cart, item) => {
                cart.items.push(item);
                Storage.saveCart(cart);
                renderCart(cart);
            }

            const generateId = () => Date.now();

            const createProduct = (id, name, priceSell, category, quantity = 1) => {
                return { id, name, priceSell, category, quantity }
            }

            const add = (name, price, category) => addToCart(cart, createProduct(generateId(), name, price, category))
         
            const getCartFilteredItemsByCategory = (categoryName) => {
                const items = cart.items.reduce((items, item) => {
                    if (item.category === categoryName) {
                        items.push(item);
                    }
                    return items;
                }, []);

                return {
                    ...cart,
                    items,
                }
            }

            const filterByCategoryAndRender = (categoryName) => {
                renderCart(getCartFilteredItemsByCategory(categoryName));
            }

        </script>
    </head> 
    <body>
        
        <div id="cart"></div>
        <div class="products">
        <h2>Add Item</h2>
            <button onclick="add('Banana', 1.99, 'fruit')">Add Banana</button>
            <button onclick="add('Apple', 2.99, 'fruit')">Add Apple</button>
            <button onclick="add('Cookie', 3.99, 'bakery')">Add Cookies</button>
            <button onclick="add('Cake', 4.99, 'bakery')">Add Cake</button>
            <button onclick="add('Car', 5.99, 'vehicle')">Add Car</button>
            <button onclick="add('Truck', 6.99, 'vehicle')">Add Truck</button>
            <hr/>
            <button onclick="clearCartAndReRender()">Clear Cart</button>
        <br />
        <h2>Filter Buttons</h2>
            <button onclick="filterByCategoryAndRender('all')">all</button>
            <button onclick="filterByCategoryAndRender('fruit')">fruit</button>
            <button onclick="filterByCategoryAndRender('bakery')">bakery</button>
            <button onclick="filterByCategoryAndRender('vehicle')">vehicle</button>
        </div>
    </body>
</html>